<custom-nav></custom-nav>
<!--school-list/index.wxml-->
<view class="container {{isMember ? 'vip-page' : 'nonvip-page'}}">
  <!-- 适应导航栏高度的顶部空间 -->
  <view style="height: {{navHeight}}px;"></view>
  <!-- 添加渐变背景欢迎区域 -->
  <view class="header-gradient">
    <view class="welcome-text">
      <view class="text-white text-lg font-bold">高中信息查询</view>
      <view class="text-white opacity-80 font-sm mt-1">查找并了解各高中详细招生信息</view>
    </view>
    <!-- 修改后的搜索栏和筛选按钮布局 -->
    <view class="header">
      <view class="search-box">
        <view class="search-input-wrapper">
          <input 
            class="search-input"
            placeholder="{{isMember ? '搜索学校名称' : '开通会员可搜索学校名称'}}" 
            placeholder-style="color: #fff;"
            value="{{searchKeyword}}"
            bindinput="handleSearchInput"
            disabled="{{!isMember}}"
          />
          <view class="clear-icon" bindtap="clearSearch" wx:if="{{searchKeyword}}">×</view>
        </view>
      </view>
      <!-- 非会员点击筛选按钮时触发 VIP 提示 -->
      <view class="filter-btn" bindtap="{{isMember ? 'toggleFilterPanel' : 'showVipModal'}}">
        <text>筛选</text>
      </view>
    </view>
  </view>
  
  <!-- 筛选面板 -->
  <view class="filter-panel" wx:if="{{showFilterPanel && isMember}}">
    <view class="filter-section">
      <view class="filter-title">学校性质</view>
      <view class="filter-options">
        <view 
          class="filter-option {{tempFilters.type === item ? 'active' : ''}}" 
          wx:for="{{filters.type}}" 
          wx:key="*this"
          bindtap="selectFilter"
          data-type="type"
          data-value="{{item}}"
        >{{item}}</view>
      </view>
    </view>
    
    <view class="filter-section">
      <view class="filter-title">学校等级</view>
      <view class="filter-options">
        <view 
          class="filter-option {{tempFilters.level === item ? 'active' : ''}}" 
          wx:for="{{filters.level}}" 
          wx:key="*this"
          bindtap="selectFilter"
          data-type="level"
          data-value="{{item}}"
        >{{item}}</view>
      </view>
    </view>
    
    <view class="filter-btns">
      <view class="reset-btn" bindtap="resetFilters">重置</view>
      <view class="confirm-btn" bindtap="confirmFilters">确定</view>
    </view>
  </view>
  
  <!-- 温馨提醒卡片 -->
  <view class="reminder-card" wx:if="{{showReminderCard}}">
    <view class="reminder-title">温馨提醒：</view>
    <view class="reminder-content">
      <view class="reminder-item">1.特色班是学校为在特定领域(如艺术、体育等)有专长或兴趣的学生设立的专项班级,旨在结合文化教育与特长培养；</view>
      <view class="reminder-item">2.信息及排名均来自网络，如有错误恳请指出，方便及时修改。</view>
    </view>
  </view>
  
  <!-- 学校列表 -->
  <view class="school-list">
    <view class="school-list-container relative">
      <!-- 会员显示完整列表 -->
      <block wx:if="{{isMember}}">
        <view 
          class="school-item" 
          wx:for="{{schools}}" 
          wx:key="rank"
          bindtap="gotoSchoolDetail"
          data-schoolid="{{item.rank}}"
        >
          <view class="school-rank">{{item.rank}}</view>
          <view class="school-content">
            <view class="school-header">
              <view class="school-name">{{item.schoolName}}</view>
              <view class="school-score">{{item.score || '--'}}分</view>
            </view>
            <view class="school-tags">
              <view class="school-tag nature">{{item.type}}</view>
              <view class="school-tag level">{{item.level}}</view>
              <view class="school-tag rank" wx:if="{{item.position}}">位次:{{item.position}}</view>
            </view>
            <view class="school-address">{{item.address || '暂无地址信息'}}</view>
          </view>
        </view>
      </block>
      <!-- 非会员显示部分列表并加遮罩 -->
      <block wx:else>
        <view 
          class="school-item {{index > 0 ? 'blurred-item' : ''}}"
          wx:for="{{schools}}" 
          wx:key="rank"
          bindtap="gotoSchoolDetail"
          data-schoolid="{{item.rank}}"
          data-index="{{index}}"
        >
          <view class="school-rank">{{item.rank}}</view>
          <view class="school-content">
            <view class="school-header">
              <view class="school-name">{{item.schoolName}}</view>
              <view class="school-score">{{item.score || '--'}}分</view>
            </view>
            <view class="school-tags">
              <view class="school-tag nature">{{item.type}}</view>
              <view class="school-tag level">{{item.level}}</view>
              <view class="school-tag rank" wx:if="{{item.position}}">位次:{{item.position}}</view>
            </view>
            <view class="school-address">{{item.address || '暂无地址信息'}}</view>
          </view>
        </view>
        <!-- 非会员遮盖层 -->
        <view class="vip-mask partial-mask" wx:if="{{schools.length > 1}}" bindtap="goToVip">
          <view class="vip-mask-content">
            <view class="vip-mask-text">开通会员可查看完整内容</view>
            <button class="vip-btn">立即开通</button>
          </view>
        </view>
      </block>
      
      <!-- 空数据提示 -->
      <view class="empty-tip" wx:if="{{schools.length === 0}}">
        <text>没有找到符合条件的学校</text>
      </view>
    </view>
  </view>
  
  <!-- 添加学校详情组件 -->
  <school-detail school="{{selectedSchool}}" visible="{{showSchoolDetail}}" bind:close="closeSchoolDetail"></school-detail>
  
  <!-- VIP提示模态框 (非会员使用，由 JS 控制 showVipTip) -->
  <view class="search-modal {{showVipTip ? 'show' : ''}}">
    <view class="search-modal-content">
      <view class="search-modal-header">
        <view class="search-modal-title">会员专享功能</view>
        <view class="search-modal-close" bindtap="closeVipModal">×</view>
      </view>
      <view class="vip-modal-content">
        <view class="vip-modal-icon">
        </view>
        <view class="vip-modal-text">
          <text class="vip-modal-title">此功能为会员专享</text>
          <text class="vip-modal-desc">开通会员后可体验完整功能</text>
        </view>
        <button class="vip-btn-large" bindtap="goToVip">立即开通会员</button>
      </view>
    </view>
  </view>
  <view class="search-mask {{showVipTip ? 'show' : ''}}" bindtap="closeVipModal"></view>
</view>

<!-- 在文件最底部添加自定义TabBar组件引用 -->
<custom-tab-bar id="custom-tab-bar"></custom-tab-bar> 
